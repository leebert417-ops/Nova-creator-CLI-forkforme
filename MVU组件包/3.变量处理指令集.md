# 模块3：变量处理指令集

## 模块定义

本模块负责生成一套标准的"变量处理指令集"。该指令集基于模块1.0（变量结构设计）、模块1.1（变量初始化）和模块2（变量更新规则），用于指导 AI 系统如何观察、分析并请求更新当前上下文中的动态变量。

**目标**：生成指令结构本身，而非执行变量更新

**更新命令格式**：使用 **JSON Patch (RFC 6902)** 标准

**前置依赖**：
- 模块1.0（变量结构设计脚本）- 提供 Zod Schema 定义
- 模块1.1（变量初始化）- 提供变量初始值
- 模块2（变量更新规则）- 提供更新逻辑

---

## 生成任务

直接输出标准的指令集模板，无需替换具体作品的变量内容。

**操作步骤**：
1. 将下方"指令集模板"部分的内容原样输出
2. 保持模板中的占位符和格式不变

---

## 指令集模板

```yaml
---
<status_current_variables>
{{format_message_variable::stat_data}}
</status_current_variables>
rule:
  - You should output the update analysis and the actual update commands in the end of the next reply
  - The update commands must strictly follow the **JSON Patch (RFC 6902)** standard; that is, the output must be a valid JSON array containing operation objects
format: |-
  <UpdateVariable>
  <Analysis>$(IN ENGLISH, no more than 80 words)
  - ${calculate time passed: ...}
  - ${decide whether dramatic updates are allowed as it's in a special case or the time passed is more than usual: yes/no}
  - ${analyze every variable based on its corresponding `check`, according only to current reply instead of previous plots: ...}
  </Analysis>
  <JSONPatch>
  [
    { "op": "replace", "path": "${/path/to/variable}", "value": "${new_value}" },
    { "op": "add", "path": "${/path/to/array/-}", "value": "${item_to_append}" },
    { "op": "add", "path": "${/path/to/object/newKey}", "value": "${content}" }
    { "op": "move", "from": "${/source/list/0}", "path": "${/dest/list/-}" },
    { "op": "remove", "path": "${/path/to/array/0}" },
    ...
  ]
  </JSONPatch>
  </UpdateVariable>
```

---

## 输出要求

将上方"指令集模板"部分的内容原样复制到文件中，保持所有占位符和格式不变。

---

## 生成指令

生成内容后，使用 Write 工具将指令集内容保存到 `变量处理指令集.yaml` 文件中。

---

## 重要提醒

- **原样输出**：保持模板内容不变，包括所有占位符和示例
- **JSON Patch 标准**：输出的指令集遵循 RFC 6902 规范
- **路径格式**：使用 `/` 分隔，数组末尾用 `-`
- **通用性**：此为通用模板，适用于所有 MVU Zod 项目
