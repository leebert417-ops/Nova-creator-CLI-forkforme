<head>
    <style>
        :root {
            --primary: #c0392b; /* 深红色主题 */
            --accent-rose: #e74c3c;
            --accent-teal: #1abc9c;
            --accent-lilac: #9b59b6;
            --accent-pink: #ff9ff3; /* 关雅的主题色 */
            --surface: #fdf2e9;
            --surface-strong: #ffffff;
            --border: rgba(192, 57, 43, 0.2);
            --text-main: #2c3e50;
            --text-muted: #7f8c8d;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            background: transparent;
            color: var(--text-main);
            padding: 10px;
        }
        .status-card {
            max-width: 100%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }
        .status-title h1 {
            font-size: 1.4rem;
            color: var(--primary);
        }
        .status-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
        }
        .meta-item {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        .meta-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .meta-value {
            font-weight: bold;
        }
        .tab-strip {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
        }
        .tab-button {
            border: none;
            background: transparent;
            padding: 8px 15px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            color: var(--text-muted);
            font-weight: 600;
            transition: all 0.2s;
        }
        .tab-button:hover {
            background: rgba(192, 57, 43, 0.05);
            color: var(--primary);
        }
        .tab-button.active {
            background: var(--surface);
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }
        .tab-panel {
            display: none;
            flex-direction: column;
            gap: 15px;
        }
        .tab-panel.active {
            display: flex;
        }
        .panel-block {
            background: var(--surface);
            border-radius: 10px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .panel-title {
            font-size: 1rem;
            color: var(--primary);
            font-weight: bold;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .info-item {
            background: var(--surface-strong);
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .info-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            display: block;
            margin-bottom: 2px;
        }
        .info-value {
            font-size: 0.95rem;
            font-weight: 600;
        }
        .progress-container {
            margin-top: 5px;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 2px;
        }
        .progress-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }
    </style>
    <script type="module">
        /* 更新进度条辅助函数 */
        function updateProgressBar(barId, valueId, rawValue, min = 0, max = 100, color = '#c0392b') {
            const numericValue = parseFloat(rawValue);
            if (!isNaN(numericValue)) {
                const clampedValue = _.clamp(numericValue, min, max);
                const percentage = max - min === 0 ? 0 : ((clampedValue - min) / (max - min)) * 100;

                $(`#${valueId}`).text(clampedValue);
                $(`#${barId}`).css({
                    width: `${percentage}%`,
                    backgroundColor: color
                });
            } else {
                $(`#${valueId}`).text(rawValue);
            }
        }

        /* 填充状态栏数据 */
        function populateCharacterData() {
            try {
                const all_variables = getAllVariables();
                const characterData = all_variables.stat_data;

                if (!characterData) {
                    $('#status-card').html("<div class='error-tip'>无法加载状态数据</div>");
                    return;
                }

                /* 世界状态 */
                $('#current-time').text(_.get(characterData, '世界.当前时间', 'N/A'));
                $('#current-location').text(_.get(characterData, '世界.当前地点', 'N/A'));
                $('#current-event').text(_.get(characterData, '世界.当前事件', 'N/A'));

                /* 陈环 */
                updateProgressBar('chenhuan-affection-bar', 'chenhuan-affection', _.get(characterData, '陈环.好感度', 0), 0, 100, '#e74c3c');
                updateProgressBar('chenhuan-dev-bar', 'chenhuan-dev', _.get(characterData, '陈环.开发度', 0), 0, 100, '#d35400');
                $('#chenhuan-outfit').text(_.get(characterData, '陈环.当前着装', 'N/A'));
                $('#chenhuan-status').text(_.get(characterData, '陈环.当前状态', 'N/A'));
                $('#chenhuan-gene').text(_.get(characterData, '陈环.基因倾向', 'N/A'));

                /* 刘奈妲 */
                updateProgressBar('liunaida-affection-bar', 'liunaida-affection', _.get(characterData, '刘奈妲.好感度', 0), 0, 100, '#e67e22');
                updateProgressBar('liunaida-dev-bar', 'liunaida-dev', _.get(characterData, '刘奈妲.开发度', 0), 0, 100, '#d35400');
                $('#liunaida-outfit').text(_.get(characterData, '刘奈妲.当前着装', 'N/A'));
                $('#liunaida-status').text(_.get(characterData, '刘奈妲.当前状态', 'N/A'));
                $('#liunaida-gene').text(_.get(characterData, '刘奈妲.基因倾向', 'N/A'));

                /* 付娅 */
                updateProgressBar('fuya-affection-bar', 'fuya-affection', _.get(characterData, '付娅.好感度', 0), 0, 100, '#9b59b6');
                updateProgressBar('fuya-dev-bar', 'fuya-dev', _.get(characterData, '付娅.开发度', 0), 0, 100, '#8e44ad');
                $('#fuya-outfit').text(_.get(characterData, '付娅.当前着装', 'N/A'));
                $('#fuya-status').text(_.get(characterData, '付娅.当前状态', 'N/A'));
                $('#fuya-gene').text(_.get(characterData, '付娅.基因倾向', 'N/A'));

                /* 关雅 - 更新 */
                updateProgressBar('guanya-affection-bar', 'guanya-affection', _.get(characterData, '关雅.好感度', 0), 0, 100, '#ff9ff3');
                updateProgressBar('guanya-dev-bar', 'guanya-dev', _.get(characterData, '关雅.开发度', 0), 0, 100, '#fd79a8');
                $('#guanya-outfit').text(_.get(characterData, '关雅.当前着装', 'N/A'));
                $('#guanya-status').text(_.get(characterData, '关雅.当前状态', 'N/A'));
                $('#guanya-gene').text(_.get(characterData, '关雅.基因倾向', 'N/A'));

            } catch (error) {
                console.error("Status bar error:", error);
                $('#status-card').html(`<div style='color:red'>加载出错: ${error.message}</div>`);
            }
        }

        /* 切换标签 */
        function switchTab(tabName, $tabElement) {
            $('.tab-button').removeClass('active');
            $('.tab-panel').removeClass('active');

            if ($tabElement) {
                $tabElement.addClass('active');
            } else {
                $(`[data-tab="${tabName}"]`).addClass('active');
            }

            $(`#tab-content-${tabName}`).addClass('active');
        }

        /* 初始化 */
        async function init() {
            await waitGlobalInitialized('Mvu');
            populateCharacterData();

            /* 绑定标签切换事件 */
            $('.tab-button').on('click', function () {
                const tabName = $(this).data('tab');
                switchTab(tabName, $(this));
            });
        }

        $(errorCatched(init));
    </script>
</head>
<body>
<div class="status-card" id="status-card">
    <header class="status-header">
        <div class="status-title">
            <h1>制造美人2.0</h1>
        </div>
        <div class="status-meta">
            <div class="meta-item">
                <span class="meta-label">时间</span>
                <span class="meta-value" id="current-time">N/A</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">地点</span>
                <span class="meta-value" id="current-location">N/A</span>
            </div>
             <div class="meta-item">
                <span class="meta-label">事件</span>
                <span class="meta-value" id="current-event">N/A</span>
            </div>
        </div>
    </header>

    <nav class="tab-strip" role="tablist">
        <button type="button" class="tab-button active" data-tab="chenhuan">陈环</button>
        <button type="button" class="tab-button" data-tab="liunaida">刘奈妲</button>
        <button type="button" class="tab-button" data-tab="fuya">付娅</button>
        <button type="button" class="tab-button" data-tab="guanya">关雅</button>
    </nav>

    <section class="tab-panel active" id="tab-content-chenhuan">
        <div class="panel-block">
            <h3 class="panel-title">基本信息</h3>
            <div class="info-grid">
                <div class="info-item">
                     <span class="info-label">基因倾向</span>
                     <span class="info-value" id="chenhuan-gene">N/A</span>
                </div>
                 <div class="info-item">
                     <span class="info-label">当前状态</span>
                     <span class="info-value" id="chenhuan-status">N/A</span>
                </div>
            </div>
             <div class="info-item">
                 <span class="info-label">当前着装</span>
                 <span class="info-value" id="chenhuan-outfit">N/A</span>
            </div>
        </div>
        <div class="panel-block">
            <h3 class="panel-title">关系与进度</h3>
             <div class="progress-container">
                <div class="progress-label">
                    <span>好感度</span>
                    <span id="chenhuan-affection">0</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="chenhuan-affection-bar"></div></div>
            </div>
            <div class="progress-container">
                <div class="progress-label">
                    <span>开发度</span>
                    <span id="chenhuan-dev">0</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="chenhuan-dev-bar"></div></div>
            </div>
        </div>
    </section>

    <section class="tab-panel" id="tab-content-liunaida">
        <div class="panel-block">
            <h3 class="panel-title">基本信息</h3>
            <div class="info-grid">
                <div class="info-item">
                     <span class="info-label">基因倾向</span>
                     <span class="info-value" id="liunaida-gene">N/A</span>
                </div>
                 <div class="info-item">
                     <span class="info-label">当前状态</span>
                     <span class="info-value" id="liunaida-status">N/A</span>
                </div>
            </div>
             <div class="info-item">
                 <span class="info-label">当前着装</span>
                 <span class="info-value" id="liunaida-outfit">N/A</span>
            </div>
        </div>
        <div class="panel-block">
            <h3 class="panel-title">关系与进度</h3>
             <div class="progress-container">
                <div class="progress-label">
                    <span>好感度</span>
                    <span id="liunaida-affection">0</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="liunaida-affection-bar"></div></div>
            </div>
            <div class="progress-container">
                <div class="progress-label">
                    <span>开发度</span>
                    <span id="liunaida-dev">0</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="liunaida-dev-bar"></div></div>
            </div>
        </div>
    </section>

    <section class="tab-panel" id="tab-content-fuya">
        <div class="panel-block">
            <h3 class="panel-title">基本信息</h3>
            <div class="info-grid">
                <div class="info-item">
                     <span class="info-label">基因倾向</span>
                     <span class="info-value" id="fuya-gene">N/A</span>
                </div>
                 <div class="info-item">
                     <span class="info-label">当前状态</span>
                     <span class="info-value" id="fuya-status">N/A</span>
                </div>
            </div>
             <div class="info-item">
                 <span class="info-label">当前着装</span>
                 <span class="info-value" id="fuya-outfit">N/A</span>
            </div>
        </div>
        <div class="panel-block">
            <h3 class="panel-title">关系与进度</h3>
             <div class="progress-container">
                <div class="progress-label">
                    <span>好感度</span>
                    <span id="fuya-affection">0</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="fuya-affection-bar"></div></div>
            </div>
            <div class="progress-container">
                <div class="progress-label">
                    <span>开发度</span>
                    <span id="fuya-dev">0</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="fuya-dev-bar"></div></div>
            </div>
        </div>
    </section>

    <section class="tab-panel" id="tab-content-guanya">
        <div class="panel-block">
            <h3 class="panel-title">基本信息</h3>
            <div class="info-grid">
                <div class="info-item">
                     <span class="info-label">基因倾向</span>
                     <span class="info-value" id="guanya-gene">N/A</span>
                </div>
                 <div class="info-item">
                     <span class="info-label">当前状态</span>
                     <span class="info-value" id="guanya-status">N/A</span>
                </div>
            </div>
             <div class="info-item">
                 <span class="info-label">当前着装</span>
                 <span class="info-value" id="guanya-outfit">N/A</span>
            </div>
        </div>
        <div class="panel-block">
            <h3 class="panel-title">关系与进度</h3>
             <div class="progress-container">
                <div class="progress-label">
                    <span>好感度</span>
                    <span id="guanya-affection">0</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="guanya-affection-bar"></div></div>
            </div>
             <div class="progress-container">
                <div class="progress-label">
                    <span>开发度</span>
                    <span id="guanya-dev">0</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="guanya-dev-bar"></div></div>
            </div>
        </div>
    </section>
</div>
</body>