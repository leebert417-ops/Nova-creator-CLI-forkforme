<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ¦œä¸€å¤§å“¥æ¨¡æ‹Ÿå™¨</title>
    <style>
      :root {
        --day-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --day-card-bg: rgba(255, 255, 255, 0.95);
        --day-text: #2d3748;
        --day-text-secondary: #4a5568;
        --day-border: #e2e8f0;
        --day-button-bg: #667eea;
        --day-button-hover: #5a67d8;

        --night-bg: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
        --night-card-bg: rgba(45, 55, 72, 0.95);
        --night-text: #f7fafc;
        --night-text-secondary: #cbd5e0;
        --night-border: #4a5568;
        --night-button-bg: #805ad5;
        --night-button-hover: #6b46c1;
      }

      body {
        margin: 0;
        padding: 10px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: transparent;
        transition: background 0.5s ease;
      }

      body.day-mode {
        background: var(--day-bg);
      }

      body.night-mode {
        background: var(--night-bg);
      }

      .status-card {
        width: auto;
        max-width: none;
        margin: 0;
        border-radius: 8px;
        overflow: hidden;
        transition: all 0.5s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .day-mode .status-card {
        background: var(--day-card-bg);
      }

      .night-mode .status-card {
        background: var(--night-card-bg);
      }

      .card-header {
        padding: 20px;
        text-align: center;
        border-bottom: 2px solid;
        transition: all 0.5s ease;
      }

      .day-mode .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-bottom-color: var(--day-border);
      }

      .night-mode .card-header {
        background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
        border-bottom-color: var(--night-border);
      }

      .card-header h2 {
        margin: 0;
        color: white;
        font-size: 24px;
        font-weight: 600;
      }

      .card-body {
        padding: 24px;
      }

      .info-section {
        margin-bottom: 20px;
      }

      .info-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        margin-bottom: 12px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .day-mode .info-item {
        background: rgba(102, 126, 234, 0.1);
        border: 1px solid var(--day-border);
      }

      .night-mode .info-item {
        background: rgba(128, 90, 213, 0.1);
        border: 1px solid var(--night-border);
      }

      .info-icon {
        font-size: 20px;
        margin-right: 12px;
        width: 24px;
        text-align: center;
      }

      .info-label {
        font-weight: 600;
        margin-right: 12px;
        min-width: 60px;
        transition: color 0.5s ease;
      }

      .day-mode .info-label {
        color: var(--day-text);
      }

      .night-mode .info-label {
        color: var(--night-text);
      }

      .info-value {
        flex: 1;
        font-size: 16px;
        transition: color 0.5s ease;
      }

      .day-mode .info-value {
        color: var(--day-text-secondary);
      }

      .night-mode .info-value {
        color: var(--night-text-secondary);
      }

      .time-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.5s ease;
      }

      .day-mode .time-badge {
        background: linear-gradient(135deg, #fbd38d 0%, #f6ad55 100%);
        color: #744210;
      }

      .night-mode .time-badge {
        background: linear-gradient(135deg, #4c51bf 0%, #434190 100%);
        color: #e9d8fd;
      }

      /* ä¸»æ’­ä¿¡æ¯æ  */
      .streamer-section {
        margin-bottom: 20px;
      }

      .streamer-header {
        padding: 12px 16px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        border: 2px solid;
      }

      .day-mode .streamer-header {
        background: rgba(255, 182, 193, 0.15);
        border-color: #ffb6c1;
      }

      .day-mode .streamer-header:hover {
        background: rgba(255, 182, 193, 0.25);
      }

      .night-mode .streamer-header {
        background: rgba(255, 182, 193, 0.1);
        border-color: #9f7aea;
      }

      .night-mode .streamer-header:hover {
        background: rgba(255, 182, 193, 0.15);
      }

      .streamer-header-left {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .streamer-name-badge {
        background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
      }

      .favor-badge {
        background: rgba(255, 107, 157, 0.2);
        padding: 4px 10px;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
      }

      .day-mode .favor-badge {
        color: #c44569;
      }

      .night-mode .favor-badge {
        color: #ff8fab;
      }

      .expand-arrow {
        font-size: 14px;
        transition: transform 0.3s ease;
      }

      .day-mode .expand-arrow {
        color: var(--day-text);
      }

      .night-mode .expand-arrow {
        color: var(--night-text);
      }

      .streamer-details {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        margin-top: 12px;
      }

      .streamer-details.expanded {
        max-height: 500px;
      }

      .favor-bar-container {
        margin-bottom: 16px;
      }

      .favor-label {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .day-mode .favor-label {
        color: var(--day-text);
      }

      .night-mode .favor-label {
        color: var(--night-text);
      }

      .favor-progress-bg {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
      }

      .favor-progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff6b9d 0%, #ff8fab 100%);
        transition: width 0.5s ease;
        border-radius: 4px;
      }

      .streamer-info-group {
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 12px;
      }

      .day-mode .streamer-info-group {
        background: rgba(102, 126, 234, 0.05);
        border: 1px solid var(--day-border);
      }

      .night-mode .streamer-info-group {
        background: rgba(128, 90, 213, 0.05);
        border: 1px solid var(--night-border);
      }

      .info-group-title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 12px;
      }

      .day-mode .info-group-title {
        color: var(--day-text);
      }

      .night-mode .info-group-title {
        color: var(--night-text);
      }

      .info-detail-row {
        margin-bottom: 8px;
        font-size: 14px;
        line-height: 1.5;
      }

      .detail-label {
        font-weight: 600;
        display: inline-block;
        min-width: 60px;
      }

      .day-mode .detail-label {
        color: var(--day-text);
      }

      .night-mode .detail-label {
        color: var(--night-text);
      }

      .detail-text {
        transition: color 0.5s ease;
      }

      .day-mode .detail-text {
        color: var(--day-text-secondary);
      }

      .night-mode .detail-text {
        color: var(--night-text-secondary);
      }

      .status-badge {
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 14px;
        text-align: center;
      }

      .day-mode .status-badge {
        background: rgba(102, 126, 234, 0.1);
        color: var(--day-text);
      }

      .night-mode .status-badge {
        background: rgba(128, 90, 213, 0.1);
        color: var(--night-text);
      }

      /* æŒ‰é’®åŒºåŸŸ */
      .action-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .action-button {
        padding: 14px 20px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .day-mode .action-button {
        background: var(--day-button-bg);
        color: white;
      }

      .day-mode .action-button:hover {
        background: var(--day-button-hover);
        transform: translateY(-2px);
      }

      .night-mode .action-button {
        background: var(--night-button-bg);
        color: white;
      }

      .night-mode .action-button:hover {
        background: var(--night-button-hover);
        transform: translateY(-2px);
      }

      .action-button:active {
        transform: translateY(0);
      }

      .day-buttons,
      .night-buttons {
        display: none;
        grid-column: 1 / -1;
        grid-template-columns: inherit;
        gap: inherit;
      }

      .day-buttons.active,
      .night-buttons.active {
        display: grid;
      }

      /* å¹³å°é€‰æ‹©å¼¹çª— */
      .platform-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        justify-content: center;
        align-items: center;
      }

      .platform-modal.show {
        display: flex;
      }

      .platform-content {
        background: white;
        border-radius: 16px;
        padding: 40px;
        max-width: 600px;
        width: 90%;
        max-height: 400px;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      .platform-header {
        text-align: center;
        margin-bottom: 24px;
        flex-shrink: 0;
      }

      .platform-title {
        font-size: 24px;
        font-weight: 600;
        color: #2d3748;
        margin: 0 0 8px 0;
      }

      .platform-subtitle {
        font-size: 14px;
        color: #718096;
      }

      .platform-carousel {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      .platform-slide {
        display: none;
        width: 100%;
        text-align: center;
      }

      .platform-slide.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .platform-card {
        padding: 20px;
        border: 1px solid #e2e8f0;
        border-left: 4px solid;
        border-radius: 8px;
        background: white;
        transition: all 0.3s ease;
        margin: 0 auto;
        max-width: 500px;
        text-align: left;
      }

      .platform-card:hover {
        border-color: #667eea;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .platform-card.normal {
        border-left-color: #0ea5e9;
      }

      .platform-card.normal:hover {
        border-left-color: #0284c7;
        background: #f0f9ff;
      }

      .platform-card.spicy {
        border-left-color: #ec4899;
      }

      .platform-card.spicy:hover {
        border-left-color: #db2777;
        background: #fdf2f8;
      }

      .platform-card.adult {
        border-left-color: #ef4444;
      }

      .platform-card.adult:hover {
        border-left-color: #dc2626;
        background: #fef2f2;
      }

      .platform-icon {
        font-size: 32px;
        margin-right: 12px;
        display: inline-block;
        vertical-align: middle;
      }

      .platform-name {
        font-size: 18px;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 8px;
        display: inline-block;
        vertical-align: middle;
      }

      .platform-description {
        font-size: 14px;
        color: #718096;
        line-height: 1.6;
        margin-top: 8px;
      }

      .platform-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 24px;
        flex-shrink: 0;
      }

      .platform-nav-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .platform-nav-btn:hover {
        background: #5a67d8;
        transform: translateY(-2px);
      }

      .platform-nav-btn:disabled {
        background: #cbd5e0;
        cursor: not-allowed;
        transform: none;
      }

      .platform-indicator {
        display: flex;
        gap: 8px;
      }

      .platform-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #cbd5e0;
        transition: all 0.3s ease;
      }

      .platform-dot.active {
        background: #667eea;
        width: 24px;
        border-radius: 4px;
      }

      .platform-select-btn {
        width: 100%;
        margin-top: 16px;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .platform-select-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      @media (max-width: 768px) {
        body {
          padding: 5px;
        }

        .card-header h2 {
          font-size: 20px;
        }

        .card-body {
          padding: 16px;
        }

        .action-section {
          grid-template-columns: 1fr;
        }

        .platform-content {
          padding: 24px;
          max-height: 500px;
        }

        .platform-card {
          padding: 16px;
        }

        .platform-icon {
          font-size: 28px;
        }

        .platform-name {
          font-size: 16px;
        }

        .platform-nav-btn {
          padding: 10px 16px;
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="status-card">
      <div class="card-header">
        <h2>æ¦œä¸€å¤§å“¥æ¨¡æ‹Ÿå™¨</h2>
      </div>

      <div class="card-body">
        <!-- åŸºç¡€ä¿¡æ¯ -->
        <div class="info-section">
          <div class="info-item">
            <span class="info-icon">ğŸ•</span>
            <span class="info-label">æ—¶é—´</span>
            <span class="info-value">
              <span class="time-badge" id="time-display">åŠ è½½ä¸­...</span>
            </span>
          </div>
          <div class="info-item">
            <span class="info-icon">ğŸ“</span>
            <span class="info-label">åœ°ç‚¹</span>
            <span class="info-value" id="location-display">åŠ è½½ä¸­...</span>
          </div>
        </div>

        <!-- ä¸»æ’­ä¿¡æ¯æ ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div class="streamer-section" id="streamerSection" style="display: none">
          <div class="streamer-header" onclick="toggleStreamerInfo()">
            <div class="streamer-header-left">
              <span class="info-icon">ğŸ’ƒ</span>
              <span class="info-label">å½“å‰ä¸»æ’­</span>
              <span class="streamer-name-badge" id="currentStreamerName">-</span>
              <span class="favor-badge">â¤ï¸ <span id="quickFavor">0</span></span>
            </div>
            <span class="expand-arrow" id="streamerArrow">â–¼</span>
          </div>

          <div class="streamer-details" id="streamerDetails">
            <div class="favor-bar-container">
              <div class="favor-label">ğŸ’— å¥½æ„Ÿåº¦: <span id="favorValue">0</span>/100</div>
              <div class="favor-progress-bg">
                <div class="favor-progress-fill" id="favorProgress" style="width: 0%"></div>
              </div>
            </div>

            <div class="streamer-info-group">
              <div class="info-group-title">ğŸ“ ä¸»æ’­ä¿¡æ¯</div>
              <div class="info-detail-row">
                <span class="detail-label">å¤–è²Œ:</span>
                <span class="detail-text" id="streamerAppearance">-</span>
              </div>
              <div class="info-detail-row">
                <span class="detail-label">èº«æ:</span>
                <span class="detail-text" id="streamerBody">-</span>
              </div>
              <div class="info-detail-row">
                <span class="detail-label">èƒ¸éƒ¨:</span>
                <span class="detail-text" id="streamerBust">-</span>
              </div>
              <div class="info-detail-row">
                <span class="detail-label">è‡€éƒ¨:</span>
                <span class="detail-text" id="streamerHips">-</span>
              </div>
              <div class="info-detail-row">
                <span class="detail-label">å¹³å°:</span>
                <span class="detail-text" id="streamerPlatform">-</span>
              </div>
            </div>

            <div class="status-badge" id="interactionStatus">ğŸ“Š çŠ¶æ€: -</div>
          </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-section">
          <div class="day-buttons" id="day-buttons">
            <button class="action-button" onclick="onWorkClick()">ğŸ’¼ å·¥ä½œ</button>
            <button class="action-button" onclick="onPlatformClick()">ğŸ“± è§‚çœ‹ç›´æ’­</button>
          </div>
          <div class="night-buttons" id="night-buttons">
            <button class="action-button" onclick="onRestClick()">ğŸ˜´ ä¼‘æ¯</button>
            <button class="action-button" onclick="onPlatformClick()">ğŸ“± è§‚çœ‹ç›´æ’­</button>
          </div>
        </div>
      </div>
    </div>

    <!-- å¹³å°é€‰æ‹©å¼¹çª— -->
    <div class="platform-modal" id="platformModal">
      <div class="platform-content">
        <div class="platform-header">
          <h2 class="platform-title">é€‰æ‹©ç›´æ’­å¹³å°</h2>
          <p class="platform-subtitle">å·¦å³åˆ‡æ¢æµè§ˆå¹³å°</p>
        </div>

        <div class="platform-carousel">
          <!-- å¹³å°1: çŒ«é±¼ç›´æ’­ -->
          <div class="platform-slide active" data-platform="çŒ«é±¼ç›´æ’­">
            <div class="platform-card normal">
              <div>
                <span class="platform-icon">ğŸ±</span>
                <span class="platform-name">çŒ«é±¼ç›´æ’­</span>
              </div>
              <div class="platform-description">ç›‘ç®¡ä¸¥æ ¼çš„æ­£è§„å¹³å°ï¼Œä¸»æ’­ä»¬åœ¨è¿™é‡Œå±•ç¤ºæ‰è‰ºï¼Œæ°›å›´ç›¸å¯¹çº¯å‡€ã€‚</div>
              <button class="platform-select-btn" onclick="selectCurrentPlatform()">è¿›å…¥çŒ«é±¼ç›´æ’­</button>
            </div>
          </div>

          <!-- å¹³å°2: èœœæ¡ƒç›´æ’­ -->
          <div class="platform-slide" data-platform="èœœæ¡ƒç›´æ’­">
            <div class="platform-card spicy">
              <div>
                <span class="platform-icon">ğŸ‘</span>
                <span class="platform-name">èœœæ¡ƒç›´æ’­</span>
              </div>
              <div class="platform-description">æ¸¸èµ°åœ¨ç°è‰²åœ°å¸¦çš„å¹³å°ï¼Œè¿™é‡Œçš„ä¸»æ’­æ›´å¤§èƒ†ï¼Œå†…å®¹æ›´å…·è¯±æƒ‘åŠ›ã€‚</div>
              <button class="platform-select-btn" onclick="selectCurrentPlatform()">è¿›å…¥èœœæ¡ƒç›´æ’­</button>
            </div>
          </div>

          <!-- å¹³å°3: å¤©å ‚å²› -->
          <div class="platform-slide" data-platform="å¤©å ‚å²›">
            <div class="platform-card adult">
              <div>
                <span class="platform-icon">ğŸï¸</span>
                <span class="platform-name">å¤©å ‚å²›</span>
              </div>
              <div class="platform-description">å®Œå…¨æ— é™åˆ¶çš„æˆäººå¹³å°ï¼Œå¯ä»¥æ»¡è¶³ä½ æœ€æ·±å±‚çš„å¹»æƒ³ã€‚</div>
              <button class="platform-select-btn" onclick="selectCurrentPlatform()">è¿›å…¥å¤©å ‚å²›</button>
            </div>
          </div>
        </div>

        <!-- å¯¼èˆªæ§åˆ¶ -->
        <div class="platform-nav">
          <button class="platform-nav-btn" onclick="previousPlatform()">â† ä¸Šä¸€ä¸ª</button>
          <div class="platform-indicator">
            <div class="platform-dot active"></div>
            <div class="platform-dot"></div>
            <div class="platform-dot"></div>
          </div>
          <button class="platform-nav-btn" onclick="nextPlatform()">ä¸‹ä¸€ä¸ª â†’</button>
        </div>
      </div>
    </div>

    <script>
      function SafeGetValue(obj, path, defaultValue = 'N/A') {
        let keys = Array.isArray(path) ? path : path.split('.');
        let current = obj;
        for (let i = 0; i < keys.length; i++) {
          if (
            current === undefined ||
            current === null ||
            typeof current !== 'object' ||
            !current.hasOwnProperty(keys[i])
          ) {
            return defaultValue;
          }
          current = current[keys[i]];
        }
        if (current === undefined || current === null) {
          return defaultValue;
        }
        if (Array.isArray(current)) {
          if (current.length > 0) {
            const actualValue = current[0];
            if (typeof actualValue === 'boolean') {
              return actualValue;
            }
            return String(actualValue);
          } else {
            return defaultValue;
          }
        }
        if (typeof current === 'boolean') {
          return current;
        }
        return String(current);
      }

      let isStreamerExpanded = false;

      function toggleStreamerInfo() {
        isStreamerExpanded = !isStreamerExpanded;
        const details = document.getElementById('streamerDetails');
        const arrow = document.getElementById('streamerArrow');

        if (isStreamerExpanded) {
          details.classList.add('expanded');
          arrow.innerText = 'â–²';
        } else {
          details.classList.remove('expanded');
          arrow.innerText = 'â–¼';
        }
      }

      async function initDisplay() {
        try {
          const messages = await getChatMessages(getCurrentMessageId());
          if (!messages || messages.length === 0 || !messages[0].data) {
            console.error('æ— æ³•åŠ è½½çŠ¶æ€æ•°æ®');
            return;
          }

          const gameData = messages[0].data;
          const characterData = gameData.stat_data;
          if (!characterData) {
            console.error('æ— æ³•åŠ è½½è§’è‰²æ•°æ®');
            return;
          }

          // è¯»å–åŸºç¡€ä¿¡æ¯
          const timeValue = SafeGetValue(characterData, 'æ—¶é—´', 'å¤œæ™š');
          const currentTimeMinutes = SafeGetValue(characterData, 'å½“å‰æ—¶åˆ»', 1230);
          const locationValue = SafeGetValue(characterData, 'åœ°ç‚¹', 'æ±Ÿæ™¯åˆ«å¢…');
          const nightDetection = SafeGetValue(characterData, 'å¤œæ™šç›‘æµ‹', '1');

          // è½¬æ¢æ—¶é—´æ ¼å¼
          const minutes = parseInt(currentTimeMinutes) || 1230;
          const hours = Math.floor(minutes / 60) % 24;
          const mins = minutes % 60;
          const currentTimeValue = `${String(hours).padStart(2, '0')}:${String(mins).padStart(2, '0')}`;

          // æ›´æ–°åŸºç¡€ä¿¡æ¯æ˜¾ç¤º
          document.getElementById('time-display').innerText = `${timeValue} ${currentTimeValue}`;
          document.getElementById('location-display').innerText = locationValue;

          // è®¾ç½®ç™½å¤©/å¤œæ™šæ¨¡å¼
          const isNight = nightDetection === '1' || nightDetection === 1 || nightDetection === true;
          const bodyElement = document.body;
          const dayButtons = document.getElementById('day-buttons');
          const nightButtons = document.getElementById('night-buttons');

          if (isNight) {
            bodyElement.classList.remove('day-mode');
            bodyElement.classList.add('night-mode');
            if (dayButtons) dayButtons.classList.remove('active');
            if (nightButtons) nightButtons.classList.add('active');
          } else {
            bodyElement.classList.remove('night-mode');
            bodyElement.classList.add('day-mode');
            if (nightButtons) nightButtons.classList.remove('active');
            if (dayButtons) dayButtons.classList.add('active');
          }

          // æ›´æ–°ä¸»æ’­ä¿¡æ¯
          updateStreamerSection(characterData);
        } catch (error) {
          console.error('çŠ¶æ€æ åŠ è½½å‡ºé”™:', error);
        }
      }

      function updateStreamerSection(characterData) {
        const section = document.getElementById('streamerSection');
        const currentStreamer = SafeGetValue(characterData, 'å½“å‰ä¸»æ’­', '');
        const streamerInfo = characterData['å½“å‰ä¸»æ’­ä¿¡æ¯'] || {};
        const favor = parseInt(SafeGetValue(characterData, 'å¥½æ„Ÿåº¦', '0')) || 0;
        const interactionStatus = SafeGetValue(characterData, 'äº’åŠ¨çŠ¶æ€', '');

        // å¦‚æœæ²¡æœ‰å½“å‰ä¸»æ’­ï¼Œéšè—æ•´ä¸ªåŒºåŸŸ
        if (!currentStreamer || currentStreamer === '') {
          section.style.display = 'none';
          return;
        }

        // æ˜¾ç¤ºä¸»æ’­åŒºåŸŸ
        section.style.display = 'block';

        // æ›´æ–°æ ‡é¢˜æ ä¿¡æ¯
        document.getElementById('currentStreamerName').innerText = currentStreamer;
        document.getElementById('quickFavor').innerText = favor;

        // æ›´æ–°è¯¦ç»†ä¿¡æ¯
        document.getElementById('favorValue').innerText = favor;
        document.getElementById('favorProgress').style.width = favor + '%';
        document.getElementById('streamerAppearance').innerText = SafeGetValue(streamerInfo, 'å¤–è²Œ', '-');
        document.getElementById('streamerBody').innerText = SafeGetValue(streamerInfo, 'èº«æ', '-');
        document.getElementById('streamerBust').innerText = SafeGetValue(streamerInfo, 'èƒ¸éƒ¨', '-');
        document.getElementById('streamerHips').innerText = SafeGetValue(streamerInfo, 'è‡€éƒ¨', '-');
        document.getElementById('streamerPlatform').innerText = SafeGetValue(streamerInfo, 'æ‰€å¤„å¹³å°', '-');

        // æ›´æ–°äº’åŠ¨çŠ¶æ€
        if (interactionStatus && interactionStatus !== '') {
          document.getElementById('interactionStatus').innerText = 'ğŸ“Š çŠ¶æ€: ' + interactionStatus;
        } else {
          document.getElementById('interactionStatus').innerText = 'ğŸ“Š çŠ¶æ€: -';
        }
      }

      function onWorkClick() {
        const command = '/setinput {{user}}å†³å®šå»å·¥ä½œï¼Œå¿«é€Ÿåº¦è¿‡è¿™ä¸€å¤©';
        if (typeof SillyTavern !== 'undefined' && SillyTavern.executeSlashCommandsWithOptions) {
          SillyTavern.executeSlashCommandsWithOptions(command);
        }
      }

      function onRestClick() {
        const command = '/setinput {{user}}å†³å®šç›´æ¥ä¼‘æ¯ï¼Œå¿«è¿›åˆ°æ¬¡æ—¥ç™½å¤©';
        if (typeof SillyTavern !== 'undefined' && SillyTavern.executeSlashCommandsWithOptions) {
          SillyTavern.executeSlashCommandsWithOptions(command);
        }
      }

      let currentSlideIndex = 0;
      const platforms = ['çŒ«é±¼ç›´æ’­', 'èœœæ¡ƒç›´æ’­', 'å¤©å ‚å²›'];

      function onPlatformClick() {
        currentSlideIndex = 0;
        showSlide(0);
        document.getElementById('platformModal').classList.add('show');
      }

      function showSlide(index) {
        const slides = document.querySelectorAll('.platform-slide');
        const dots = document.querySelectorAll('.platform-dot');

        slides.forEach((slide, i) => {
          if (i === index) {
            slide.classList.add('active');
          } else {
            slide.classList.remove('active');
          }
        });

        dots.forEach((dot, i) => {
          if (i === index) {
            dot.classList.add('active');
          } else {
            dot.classList.remove('active');
          }
        });

        currentSlideIndex = index;
      }

      function nextPlatform() {
        const nextIndex = (currentSlideIndex + 1) % platforms.length;
        showSlide(nextIndex);
      }

      function previousPlatform() {
        const prevIndex = (currentSlideIndex - 1 + platforms.length) % platforms.length;
        showSlide(prevIndex);
      }

      function selectCurrentPlatform() {
        const platformName = platforms[currentSlideIndex];
        document.getElementById('platformModal').classList.remove('show');
        const command = `/setinput {{user}}æ‰“å¼€æ‰‹æœºï¼Œè¿›å…¥ã€${platformName}ã€‘æµè§ˆä¸»æ’­`;
        if (typeof SillyTavern !== 'undefined' && SillyTavern.executeSlashCommandsWithOptions) {
          SillyTavern.executeSlashCommandsWithOptions(command);
        }
      }

      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      document.getElementById('platformModal').addEventListener('click', function (e) {
        if (e.target === this) {
          this.classList.remove('show');
        }
      });

      // é”®ç›˜å¯¼èˆª
      document.addEventListener('keydown', function (e) {
        const modal = document.getElementById('platformModal');
        if (!modal.classList.contains('show')) return;

        if (e.key === 'ArrowLeft') {
          previousPlatform();
        } else if (e.key === 'ArrowRight') {
          nextPlatform();
        } else if (e.key === 'Enter') {
          selectCurrentPlatform();
        } else if (e.key === 'Escape') {
          modal.classList.remove('show');
        }
      });

      document.addEventListener('DOMContentLoaded', initDisplay);
    </script>
  </body>
</html>
