<head>
    <style>
        :root {
            --primary: #d63384; /* è‚‰æ„Ÿç²‰è‰² */
            --secondary: #6610f2; /* ç§‘æŠ€ç´« */
            --accent: #fd7e14; /* æ´»åŠ›æ©™ */
            --surface: #f8f9fa;
            --surface-strong: #ffffff;
            --border: rgba(214, 51, 132, 0.2);
            --text-main: #212529;
            --text-muted: #6c757d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            background: transparent;
            color: var(--text-main);
            padding: 10px;
        }
        .status-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            backdrop-filter: blur(10px);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
        }
        .title { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        .meta-info { font-size: 0.9rem; color: var(--text-muted); display: flex; gap: 10px; }

        .location-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--surface);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .location-label { color: var(--text-muted); }
        .location-value { font-weight: bold; color: var(--secondary); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }

        .stat-box {
            background: var(--surface);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .stat-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 4px; }
        .stat-value { font-size: 1.1rem; font-weight: bold; color: var(--secondary); }

        .progress-container {
            width: 100%;
            margin-top: 5px;
        }
        .progress-bar-bg {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .tab-nav { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-btn {
            padding: 6px 12px;
            border: none;
            background: var(--surface);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-muted);
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            font-weight: bold;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .appearance-item {
            background: var(--surface);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e9ecef;
        }
        .appearance-title {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.9rem;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .appearance-detail {
            font-size: 0.85rem;
            color: var(--text-main);
            line-height: 1.5;
            margin-bottom: 3px;
        }
        .appearance-feature {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .modification-record {
            background: var(--surface);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            margin-bottom: 8px;
        }
        .record-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        .record-title {
            font-weight: bold;
            color: var(--secondary);
            font-size: 0.9rem;
        }
        .record-date {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        .record-content {
            font-size: 0.85rem;
            color: var(--text-main);
            line-height: 1.4;
        }
        .record-remark {
            font-size: 0.8rem;
            color: var(--accent);
            margin-top: 4px;
            font-style: italic;
        }

        .current-modification {
            background: linear-gradient(135deg, rgba(214, 51, 132, 0.1), rgba(102, 16, 242, 0.1));
            padding: 12px;
            border-radius: 10px;
            border: 2px solid var(--primary);
        }
        .current-mod-title {
            font-weight: bold;
            color: var(--primary);
            font-size: 1rem;
            margin-bottom: 8px;
        }
        .current-mod-info {
            font-size: 0.85rem;
            margin-bottom: 4px;
        }
        .current-mod-label {
            color: var(--text-muted);
            display: inline-block;
            width: 80px;
        }
        .current-mod-value {
            color: var(--text-main);
            font-weight: 500;
        }

        .empty-tip {
            text-align: center;
            color: var(--text-muted);
            padding: 20px;
            font-style: italic;
        }

        .scrollable {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        .scrollable::-webkit-scrollbar {
            width: 6px;
        }
        .scrollable::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .scrollable::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
    </style>
    <script type="module">
        function updateBar(id, value, max = 100, color = '') {
            const val = _.clamp(parseFloat(value) || 0, 0, max);
            const pct = (val / max) * 100;
            $(`#${id}-val`).text(val);
            $(`#${id}-bar`).css('width', `${pct}%`);
            if (color) $(`#${id}-bar`).css('background-color', color);
        }

        function populate() {
            try {
                const vars = getAllVariables();
                const data = vars.stat_data || {};

                /* åŸºç¡€ä¿¡æ¯ */
                $('#date-display').text(_.get(data, 'æ—¶é—´.æ—¥æœŸ', '2025å¹´9æœˆ1æ—¥'));
                $('#time-display').text(_.get(data, 'æ—¶é—´.æ—¶åˆ»', 'ä¸Šåˆ'));
                $('#user-location').text(_.get(data, 'user.å½“å‰ä½ç½®', 'åŠå…¬å®¤'));
                $('#shenxin-location').text(_.get(data, 'æ²ˆé¦¨.å½“å‰ä½ç½®', 'æ•™å®¤'));
                $('#shenxin-outfit').text(_.get(data, 'æ²ˆé¦¨.å½“å‰ç©¿ç€', 'å®½æ¾å«è¡£å’Œç‰›ä»”è£¤'));

                /* åŸºç¡€çŠ¶æ€ */
                updateBar('favor', _.get(data, 'æ²ˆé¦¨.å¥½æ„Ÿåº¦', 0), 100, '#ff6b6b');
                updateBar('shame', _.get(data, 'æ²ˆé¦¨.ç¾è€»åº¦', 80), 100, '#ff922b');
                updateBar('corruption', _.get(data, 'æ²ˆé¦¨.å •è½åº¦', 0), 100, '#ae3ec9');
                updateBar('anxiety', _.get(data, 'æ²ˆé¦¨.ç„¦è™‘å€¼', 90), 100, '#20c997');

                /* å¤–è²Œè¯¦æƒ… */
                const appearance = _.get(data, 'æ²ˆé¦¨.å¤–è²Œ', {});

                // èƒ¸éƒ¨
                $('#chest-cup').text(_.get(appearance, 'èƒ¸éƒ¨.ç½©æ¯', 'Gç½©æ¯'));
                $('#chest-desc').text(_.get(appearance, 'èƒ¸éƒ¨.æè¿°', ''));
                $('#chest-feature').text(_.get(appearance, 'èƒ¸éƒ¨.ç‰¹å¾', ''));

                // è‡€éƒ¨
                $('#hip-size').text(_.get(appearance, 'è‡€éƒ¨.å°ºå¯¸', 'æ ‡å‡†åä¸°æ»¡'));
                $('#hip-desc').text(_.get(appearance, 'è‡€éƒ¨.æè¿°', ''));
                $('#hip-feature').text(_.get(appearance, 'è‡€éƒ¨.ç‰¹å¾', ''));

                // è…°éƒ¨
                $('#waist-size').text(_.get(appearance, 'è…°éƒ¨.å°ºå¯¸', 'çº¤ç»†'));
                $('#waist-desc').text(_.get(appearance, 'è…°éƒ¨.æè¿°', ''));
                $('#waist-feature').text(_.get(appearance, 'è…°éƒ¨.ç‰¹å¾', ''));

                // è…¿éƒ¨
                $('#leg-desc').text(_.get(appearance, 'è…¿éƒ¨.æè¿°', ''));
                $('#leg-feature').text(_.get(appearance, 'è…¿éƒ¨.ç‰¹å¾', ''));

                // é¢å®¹
                $('#face-shape').text(_.get(appearance, 'é¢å®¹.è„¸å‹', 'åœ†è„¸å¸¦å©´å„¿è‚¥'));
                $('#face-eyes').text(_.get(appearance, 'é¢å®¹.çœ¼ç›', ''));
                $('#face-nose').text(_.get(appearance, 'é¢å®¹.é¼»å­', ''));
                $('#face-lips').text(_.get(appearance, 'é¢å®¹.å˜´å”‡', ''));
                $('#face-desc').text(_.get(appearance, 'é¢å®¹.æè¿°', ''));

                // çš®è‚¤
                $('#skin-color').text(_.get(appearance, 'çš®è‚¤.è‚¤è‰²', 'ç™½çš™'));
                $('#skin-texture').text(_.get(appearance, 'çš®è‚¤.è´¨æ„Ÿ', ''));
                $('#skin-feature').text(_.get(appearance, 'çš®è‚¤.ç‰¹å¾', ''));

                // å¤´å‘
                $('#hair-length').text(_.get(appearance, 'å¤´å‘.é•¿åº¦', ''));
                $('#hair-style').text(_.get(appearance, 'å¤´å‘.å‘å‹', ''));
                $('#hair-feature').text(_.get(appearance, 'å¤´å‘.ç‰¹å¾', ''));

                // èº«é«˜ä½“é‡
                $('#height').text(_.get(appearance, 'èº«é«˜ä½“é‡.èº«é«˜', '158cm'));
                $('#weight').text(_.get(appearance, 'èº«é«˜ä½“é‡.ä½“é‡', 'çº¦52kg'));
                $('#body-type').text(_.get(appearance, 'èº«é«˜ä½“é‡.ä½“å‹', ''));

                /* æ”¹é€ ç³»ç»Ÿ */
                const records = _.get(data, 'æ²ˆé¦¨.æ”¹é€ è®°å½•', []);
                const $recordsList = $('#modifications-list');
                $recordsList.empty();

                if (_.isEmpty(records)) {
                    $recordsList.html('<div class="empty-tip">æš‚æ— æ”¹é€ è®°å½•</div>');
                } else {
                    _.forEach(records, (record) => {
                        const remarkHtml = record.å¤‡æ³¨ ? `<div class="record-remark">å¤‡æ³¨: ${record.å¤‡æ³¨}</div>` : '';
                        $recordsList.append(`
                            <div class="modification-record">
                                <div class="record-header">
                                    <span class="record-title">${record.éƒ¨ä½} - ${record.æ”¹é€ å†…å®¹}</span>
                                    <span class="record-date">${record.æ—¥æœŸ}</span>
                                </div>
                                <div class="record-content">
                                    <div>æ”¹é€ å‰: ${record.æ”¹é€ å‰çŠ¶æ€}</div>
                                    <div>æ”¹é€ å: ${record.æ”¹é€ åçŠ¶æ€}</div>
                                </div>
                                ${remarkHtml}
                            </div>
                        `);
                    });
                }

                /* å½“å‰æ”¹é€ é¡¹ */
                const currentMod = _.get(data, 'æ²ˆé¦¨.å½“å‰æ”¹é€ é¡¹', {});
                const isInProgress = _.get(currentMod, 'æ˜¯å¦è¿›è¡Œä¸­', false);

                if (isInProgress) {
                    $('.current-modification').show();
                    $('#current-part').text(_.get(currentMod, 'éƒ¨ä½', 'æ— '));
                    $('#current-target').text(_.get(currentMod, 'ç›®æ ‡', 'æ— '));
                    $('#current-start').text(_.get(currentMod, 'å¼€å§‹æ—¥æœŸ', ''));
                    $('#current-end').text(_.get(currentMod, 'é¢„è®¡å®Œæˆæ—¥æœŸ', ''));
                    updateBar('current-progress', _.get(currentMod, 'è¿›åº¦', 0), 100, '#0ca678');
                } else {
                    $('.current-modification').hide();
                }

            } catch (e) {
                console.error("Status Bar Error:", e);
                $('#status-card').html(`<div style="color:red">Error: ${e.message}</div>`);
            }
        }

        async function init() {
            await waitGlobalInitialized('Mvu');
            populate();

            $('.tab-btn').on('click', function() {
                $('.tab-btn').removeClass('active');
                $(this).addClass('active');
                $('.tab-content').removeClass('active');
                $(`#content-${$(this).data('tab')}`).addClass('active');
            });
        }

        $(errorCatched(init));
    </script>
</head>
<body>
    <div class="status-card" id="status-card">
        <div class="header">
            <div class="title">è‚‰èº«ç¼–ç  v0.2</div>
            <div class="meta-info">
                <span id="date-display">2025/9/1</span>
                <span id="time-display">ä¸Šåˆ</span>
            </div>
        </div>

        <div class="location-row">
            <span><span class="location-label">æ•™æˆä½ç½®:</span> <span class="location-value" id="user-location">åŠå…¬å®¤</span></span>
            <span><span class="location-label">æ²ˆé¦¨ä½ç½®:</span> <span class="location-value" id="shenxin-location">æ•™å®¤</span></span>
        </div>

        <div style="text-align:center; font-size:0.85rem; color:var(--text-muted)">
            å½“å‰ç©¿ç€: <span style="color:var(--text-main); font-weight:500" id="shenxin-outfit">å®½æ¾å«è¡£å’Œç‰›ä»”è£¤</span>
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" data-tab="status">åŸºç¡€çŠ¶æ€</button>
            <button class="tab-btn" data-tab="appearance">å¤–è²Œè¯¦æƒ…</button>
            <button class="tab-btn" data-tab="modification">æ”¹é€ ç³»ç»Ÿ</button>
        </div>

        <!-- åŸºç¡€çŠ¶æ€æ ‡ç­¾é¡µ -->
        <div id="content-status" class="tab-content active">
            <div class="grid-2">
                <div class="stat-box">
                    <span class="stat-label">å¥½æ„Ÿåº¦</span>
                    <span class="stat-value" id="favor-val">0</span>
                    <div class="progress-container"><div class="progress-bar-bg"><div id="favor-bar" class="progress-bar-fill"></div></div></div>
                </div>
                <div class="stat-box">
                    <span class="stat-label">ç„¦è™‘å€¼</span>
                    <span class="stat-value" id="anxiety-val">90</span>
                    <div class="progress-container"><div class="progress-bar-bg"><div id="anxiety-bar" class="progress-bar-fill"></div></div></div>
                </div>
                <div class="stat-box">
                    <span class="stat-label">ç¾è€»åº¦</span>
                    <span class="stat-value" id="shame-val">80</span>
                    <div class="progress-container"><div class="progress-bar-bg"><div id="shame-bar" class="progress-bar-fill"></div></div></div>
                </div>
                <div class="stat-box">
                    <span class="stat-label">å •è½åº¦</span>
                    <span class="stat-value" id="corruption-val">0</span>
                    <div class="progress-container"><div class="progress-bar-bg"><div id="corruption-bar" class="progress-bar-fill"></div></div></div>
                </div>
            </div>
        </div>

        <!-- å¤–è²Œè¯¦æƒ…æ ‡ç­¾é¡µ -->
        <div id="content-appearance" class="tab-content">
            <div class="scrollable">
                <!-- èº«é«˜ä½“é‡ -->
                <div class="appearance-item">
                    <div class="appearance-title">ğŸ“ èº«é«˜ä½“é‡</div>
                    <div class="appearance-detail">èº«é«˜: <span id="height">158cm</span> | ä½“é‡: <span id="weight">çº¦52kg</span></div>
                    <div class="appearance-feature" id="body-type">å¨‡å°ç²ç‘ï¼Œè‚‰æ„Ÿé€‚ä¸­</div>
                </div>

                <!-- èƒ¸éƒ¨ -->
                <div class="appearance-item">
                    <div class="appearance-title">ğŸ‘ èƒ¸éƒ¨ (<span id="chest-cup">Gç½©æ¯</span>)</div>
                    <div class="appearance-detail" id="chest-desc">ä¸å¨‡å°èº«ææä¸ç›¸ç§°çš„ç¡•å¤§åŒå³°</div>
                    <div class="appearance-feature" id="chest-feature">è‡ªç„¶ä¸‹å‚æ„Ÿï¼Œè§¦æ„ŸæŸ”è½¯</div>
                </div>

                <!-- è‡€éƒ¨ -->
                <div class="appearance-item">
                    <div class="appearance-title">ğŸ‘ è‡€éƒ¨ (<span id="hip-size">æ ‡å‡†åä¸°æ»¡</span>)</div>
                    <div class="appearance-detail" id="hip-desc">åœ†æ¶¦é¥±æ»¡ï¼Œå¾®å¾®ä¸Šç¿˜</div>
                    <div class="appearance-feature" id="hip-feature">ç´§è‡´æœ‰å¼¹æ€§</div>
                </div>

                <!-- è…°éƒ¨ -->
                <div class="appearance-item">
                    <div class="appearance-title">â³ è…°éƒ¨ (<span id="waist-size">çº¤ç»†</span>)</div>
                    <div class="appearance-detail" id="waist-desc">è…°èº«çº¤ç»†ä½†ä¸éª¨æ„Ÿ</div>
                    <div class="appearance-feature" id="waist-feature">ç›ˆç›ˆä¸€æ¡</div>
                </div>

                <!-- è…¿éƒ¨ -->
                <div class="appearance-item">
                    <div class="appearance-title">ğŸ¦µ è…¿éƒ¨</div>
                    <div class="appearance-detail" id="leg-desc">å¤§è…¿è‚‰è‚‰çš„ï¼Œå°è…¿åŒ€ç§°</div>
                    <div class="appearance-feature" id="leg-feature">ç™½çš™æŸ”è½¯</div>
                </div>

                <!-- é¢å®¹ -->
                <div class="appearance-item">
                    <div class="appearance-title">ğŸ˜Š é¢å®¹ (<span id="face-shape">åœ†è„¸å¸¦å©´å„¿è‚¥</span>)</div>
                    <div class="appearance-detail">
                        <div>çœ¼ç›: <span id="face-eyes">åœ†åœ†çš„æçœ¼</span></div>
                        <div>é¼»å­: <span id="face-nose">å°å·§æŒºç¿˜</span></div>
                        <div>å˜´å”‡: <span id="face-lips">ç²‰å«©é¥±æ»¡</span></div>
                    </div>
                    <div class="appearance-feature" id="face-desc">å…¸å‹çš„å¹¼æ€è„¸</div>
                </div>

                <!-- çš®è‚¤ -->
                <div class="appearance-item">
                    <div class="appearance-title">âœ¨ çš®è‚¤ (<span id="skin-color">ç™½çš™</span>)</div>
                    <div class="appearance-detail" id="skin-texture">ç»†è…»å…‰æ»‘</div>
                    <div class="appearance-feature" id="skin-feature">å®¹æ˜“æ³›èµ·çº¢æ™•</div>
                </div>

                <!-- å¤´å‘ -->
                <div class="appearance-item">
                    <div class="appearance-title">ğŸ’‡ å¤´å‘</div>
                    <div class="appearance-detail">
                        <div><span id="hair-length">é»‘é•¿ç›´ï¼Œé•¿è‡³è…°éƒ¨</span></div>
                        <div><span id="hair-style">é«˜é©¬å°¾ï¼Œæ€»æ˜¯ä¹±ç³Ÿç³Ÿçš„</span></div>
                    </div>
                    <div class="appearance-feature" id="hair-feature">å‘è´¨æŸ”é¡ºä½†ä¸çˆ±æ‰“ç†</div>
                </div>
            </div>
        </div>

        <!-- æ”¹é€ ç³»ç»Ÿæ ‡ç­¾é¡µ -->
        <div id="content-modification" class="tab-content">
            <!-- å½“å‰æ”¹é€ é¡¹ -->
            <div class="current-modification" style="display:none;">
                <div class="current-mod-title">ğŸ”¬ å½“å‰æ”¹é€ è¿›è¡Œä¸­</div>
                <div class="current-mod-info">
                    <span class="current-mod-label">éƒ¨ä½:</span>
                    <span class="current-mod-value" id="current-part">æ— </span>
                </div>
                <div class="current-mod-info">
                    <span class="current-mod-label">ç›®æ ‡:</span>
                    <span class="current-mod-value" id="current-target">æ— </span>
                </div>
                <div class="current-mod-info">
                    <span class="current-mod-label">å¼€å§‹æ—¥æœŸ:</span>
                    <span class="current-mod-value" id="current-start">-</span>
                </div>
                <div class="current-mod-info">
                    <span class="current-mod-label">é¢„è®¡å®Œæˆ:</span>
                    <span class="current-mod-value" id="current-end">-</span>
                </div>
                <div style="margin-top:8px">
                    <div style="display:flex;justify-content:space-between;font-size:0.8rem;color:#666;margin-bottom:4px">
                        <span>è¿›åº¦</span>
                        <span><span id="current-progress-val">0</span>%</span>
                    </div>
                    <div class="progress-container"><div class="progress-bar-bg"><div id="current-progress-bar" class="progress-bar-fill"></div></div></div>
                </div>
            </div>

            <!-- æ”¹é€ è®°å½•åˆ—è¡¨ -->
            <div style="margin-top:12px">
                <div style="font-weight:bold; color:var(--secondary); margin-bottom:8px; font-size:0.95rem">ğŸ“‹ æ”¹é€ è®°å½•</div>
                <div id="modifications-list" class="scrollable">
                    <!-- åŠ¨æ€å¡«å…… -->
                </div>
            </div>
        </div>
    </div>
</body>
