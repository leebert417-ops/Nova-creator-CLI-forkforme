### 模块4.2：动态世界内容生成 (灵活版)

本模块是模块4的补充与延伸，提供了一种更为灵活的方式来生成由变量驱动的动态世界书内容。它不局限于角色设定的结构，允许创作者根据变量状态，自由编写任何形式的文本，如场景描述、事件触发、内心独白等。

### 内容设计原则

1.  **选定驱动变量与划分区间/状态**：
    *   从模块1中确定一个或多个核心MVU变量作为条件判断的依据。
    *   为变量设定清晰的数值范围、特定的文本值或其他状态条件，用于划分不同的触发区间。

2.  **为每个区间/状态创作独特的提示词内容**：
    *   **内容自由**：针对每个条件区间，构思并编写任何合适的提示词内容。这可以是一段场景描述、角色的内心独白、一个特殊的事件提示、一段对话、行为指令，或任何其他需要根据变量动态变化的文本。
    *   **独特性与逻辑性**：确保每个区间触发的提示词内容都是独特的，并与驱动变量的当前状态逻辑相符。

### EJS 结构规范

为保证系统的稳定与清晰，请严格遵循以下经过优化的极简EJS结构：

1.  **错误优先处理**：脚本的起始处，必须使用一个独立的 `if` 块来检查关键变量是否已定义。这是最优先的检查，能有效避免后续操作因变量不存在而出错。
2.  **条件逻辑链**：在处理完错误情况后，使用 `else if` 链来处理所有有效的条件分支。在这些分支中，无需再重复检查变量是否存在。
3.  **禁止声明局部变量**：在EJS块内，每次进行条件判断或获取值时，都应直接调用 `getvar` 函数。
4.  **取消最终后备 `else`**：为避免在加载顺序差异下出现恒触发的默认提示，不再在链末尾添加 `else`。请通过完善条件区间来覆盖所有有效状态；必要时仅在调试时临时输出日志。
5.  **内容输出**：在每个条件分支的 `<%_ ... _%>` 标签之后，直接编写该条件下需要输出的、任意格式的独特提示词文本。

### 输出模板

请严格参考以下模板，将所有占位符及EJS逻辑中的变量路径、条件和输出内容替换为实际内容。

<example>
```yaml
---
<%_ if (getvar('stat_data.角色名.关联变量名') === undefined) { _%>
{{// 错误：关联变量 "stat_data.角色名.关联变量名" 未定义，无法生成条件内容。}}
<%_ } else if (getvar('stat_data.角色名.关联变量名') < 20) { _%>
{{// 当 [角色名] 的 [关联变量名] 小于 20 时，输出以下内容：}}
夜空中星光黯淡，[角色名]感到一阵莫名的寒意，下意识地裹紧了单薄的外套。
<%_ } else if (getvar('stat_data.角色名.关联变量名') < 50) { _%>
{{// 当 [角色名] 的 [关联变量名] 在 20 到 49 之间时，输出以下内容：}}
远处的酒馆传来隐约的歌声，[角色名]不禁想起了家乡的节日，嘴角不自觉地露出一丝微笑。
<%_ } else if (getvar('stat_data.世界.某个事件状态') === "已触发") { _%>
{{// 当 [世界] 的 [某个事件状态] 为 "已触发" 时，输出以下内容：}}
警钟突然在城中敲响！空气中弥漫着紧张的气氛，似乎有什么大事即将发生。
<%_ } _%>
```
</example>

### 系统集成说明

1.  **变量来源**：驱动变量必须是模块1中已初始化的变量。
2.  **逻辑依据**：条件区间的划分应参考模块2中为该变量定义的规则。
3.  **功能定位**：此模块是对模块4.1（分阶段角色设定）的补充，适用于创建更多样化、非角色中心的动态世界内容和事件。

### CLI指令

生成内容后，请使用Write工具将完整的EJS驱动内容保存到 `动态世界内容.xyaml` 文件中。
